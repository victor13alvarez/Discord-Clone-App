{"ast":null,"code":"import { useCallback, useLayoutEffect, useRef, useState } from 'react';\nimport { useMessageListScrollManager } from './useMessageListScrollManager';\nexport var useScrollLocationLogic = function (params) {\n  var _a = params.messages,\n      messages = _a === void 0 ? [] : _a,\n      _b = params.scrolledUpThreshold,\n      scrolledUpThreshold = _b === void 0 ? 200 : _b,\n      hasMoreNewer = params.hasMoreNewer,\n      suppressAutoscroll = params.suppressAutoscroll;\n\n  var _c = useState(false),\n      hasNewMessages = _c[0],\n      setHasNewMessages = _c[1];\n\n  var _d = useState(),\n      wrapperRect = _d[0],\n      setWrapperRect = _d[1];\n\n  var closeToBottom = useRef(false);\n  var closeToTop = useRef(false);\n  var listRef = useRef(null);\n  var scrollToBottom = useCallback(function () {\n    var _a, _b;\n\n    if (!((_a = listRef.current) === null || _a === void 0 ? void 0 : _a.scrollTo) || hasMoreNewer || suppressAutoscroll) {\n      return;\n    }\n\n    (_b = listRef.current) === null || _b === void 0 ? void 0 : _b.scrollTo({\n      top: listRef.current.scrollHeight\n    });\n    setHasNewMessages(false); // this is hacky and unreliable, but that was the current implementation so not breaking it\n\n    setTimeout(function () {\n      var _a;\n\n      (_a = listRef.current) === null || _a === void 0 ? void 0 : _a.scrollTo({\n        top: listRef.current.scrollHeight\n      });\n    }, 200);\n  }, [listRef, hasMoreNewer, suppressAutoscroll]);\n  useLayoutEffect(function () {\n    if (listRef === null || listRef === void 0 ? void 0 : listRef.current) {\n      setWrapperRect(listRef.current.getBoundingClientRect());\n      scrollToBottom();\n    }\n  }, [listRef, hasMoreNewer]);\n  var updateScrollTop = useMessageListScrollManager({\n    messages: messages,\n    onScrollBy: function (scrollBy) {\n      var _a;\n\n      (_a = listRef.current) === null || _a === void 0 ? void 0 : _a.scrollBy({\n        top: scrollBy\n      });\n    },\n    scrollContainerMeasures: function () {\n      var _a, _b;\n\n      return {\n        offsetHeight: ((_a = listRef.current) === null || _a === void 0 ? void 0 : _a.offsetHeight) || 0,\n        scrollHeight: ((_b = listRef.current) === null || _b === void 0 ? void 0 : _b.scrollHeight) || 0\n      };\n    },\n    scrolledUpThreshold: scrolledUpThreshold,\n    scrollToBottom: scrollToBottom,\n    showNewMessages: function () {\n      return setHasNewMessages(true);\n    }\n  });\n  var onScroll = useCallback(function (event) {\n    var element = event.target;\n    var scrollTop = element.scrollTop;\n    updateScrollTop(scrollTop);\n    var offsetHeight = element.offsetHeight;\n    var scrollHeight = element.scrollHeight;\n    closeToBottom.current = scrollHeight - (scrollTop + offsetHeight) < scrolledUpThreshold;\n    closeToTop.current = scrollTop < scrolledUpThreshold;\n\n    if (closeToBottom.current) {\n      setHasNewMessages(false);\n    }\n  }, [updateScrollTop, closeToTop, closeToBottom, scrolledUpThreshold]);\n  var onMessageLoadCaptured = useCallback(function () {\n    /**\n     * A load event (emitted by e.g. an <img>) was captured on a message.\n     * In some cases, the loaded asset is larger than the placeholder, which means we have to scroll down.\n     */\n    if (closeToBottom.current && !closeToTop.current) {\n      scrollToBottom();\n    }\n  }, [closeToTop, closeToBottom, scrollToBottom]);\n  return {\n    hasNewMessages: hasNewMessages,\n    listRef: listRef,\n    onMessageLoadCaptured: onMessageLoadCaptured,\n    onScroll: onScroll,\n    scrollToBottom: scrollToBottom,\n    wrapperRect: wrapperRect\n  };\n};","map":{"version":3,"sources":["C:/Users/Usuario/Documents/GitHub/discord-clone-app/client/node_modules/stream-chat-react/dist/components/MessageList/hooks/useScrollLocationLogic.js"],"names":["useCallback","useLayoutEffect","useRef","useState","useMessageListScrollManager","useScrollLocationLogic","params","_a","messages","_b","scrolledUpThreshold","hasMoreNewer","suppressAutoscroll","_c","hasNewMessages","setHasNewMessages","_d","wrapperRect","setWrapperRect","closeToBottom","closeToTop","listRef","scrollToBottom","current","scrollTo","top","scrollHeight","setTimeout","getBoundingClientRect","updateScrollTop","onScrollBy","scrollBy","scrollContainerMeasures","offsetHeight","showNewMessages","onScroll","event","element","target","scrollTop","onMessageLoadCaptured"],"mappings":"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","sourcesContent":["import { useCallback, useLayoutEffect, useRef, useState } from 'react';\nimport { useMessageListScrollManager } from './useMessageListScrollManager';\nexport var useScrollLocationLogic = function (params) {\n    var _a = params.messages, messages = _a === void 0 ? [] : _a, _b = params.scrolledUpThreshold, scrolledUpThreshold = _b === void 0 ? 200 : _b, hasMoreNewer = params.hasMoreNewer, suppressAutoscroll = params.suppressAutoscroll;\n    var _c = useState(false), hasNewMessages = _c[0], setHasNewMessages = _c[1];\n    var _d = useState(), wrapperRect = _d[0], setWrapperRect = _d[1];\n    var closeToBottom = useRef(false);\n    var closeToTop = useRef(false);\n    var listRef = useRef(null);\n    var scrollToBottom = useCallback(function () {\n        var _a, _b;\n        if (!((_a = listRef.current) === null || _a === void 0 ? void 0 : _a.scrollTo) || hasMoreNewer || suppressAutoscroll) {\n            return;\n        }\n        (_b = listRef.current) === null || _b === void 0 ? void 0 : _b.scrollTo({\n            top: listRef.current.scrollHeight,\n        });\n        setHasNewMessages(false);\n        // this is hacky and unreliable, but that was the current implementation so not breaking it\n        setTimeout(function () {\n            var _a;\n            (_a = listRef.current) === null || _a === void 0 ? void 0 : _a.scrollTo({\n                top: listRef.current.scrollHeight,\n            });\n        }, 200);\n    }, [listRef, hasMoreNewer, suppressAutoscroll]);\n    useLayoutEffect(function () {\n        if (listRef === null || listRef === void 0 ? void 0 : listRef.current) {\n            setWrapperRect(listRef.current.getBoundingClientRect());\n            scrollToBottom();\n        }\n    }, [listRef, hasMoreNewer]);\n    var updateScrollTop = useMessageListScrollManager({\n        messages: messages,\n        onScrollBy: function (scrollBy) {\n            var _a;\n            (_a = listRef.current) === null || _a === void 0 ? void 0 : _a.scrollBy({ top: scrollBy });\n        },\n        scrollContainerMeasures: function () {\n            var _a, _b;\n            return ({\n                offsetHeight: ((_a = listRef.current) === null || _a === void 0 ? void 0 : _a.offsetHeight) || 0,\n                scrollHeight: ((_b = listRef.current) === null || _b === void 0 ? void 0 : _b.scrollHeight) || 0,\n            });\n        },\n        scrolledUpThreshold: scrolledUpThreshold,\n        scrollToBottom: scrollToBottom,\n        showNewMessages: function () { return setHasNewMessages(true); },\n    });\n    var onScroll = useCallback(function (event) {\n        var element = event.target;\n        var scrollTop = element.scrollTop;\n        updateScrollTop(scrollTop);\n        var offsetHeight = element.offsetHeight;\n        var scrollHeight = element.scrollHeight;\n        closeToBottom.current = scrollHeight - (scrollTop + offsetHeight) < scrolledUpThreshold;\n        closeToTop.current = scrollTop < scrolledUpThreshold;\n        if (closeToBottom.current) {\n            setHasNewMessages(false);\n        }\n    }, [updateScrollTop, closeToTop, closeToBottom, scrolledUpThreshold]);\n    var onMessageLoadCaptured = useCallback(function () {\n        /**\n         * A load event (emitted by e.g. an <img>) was captured on a message.\n         * In some cases, the loaded asset is larger than the placeholder, which means we have to scroll down.\n         */\n        if (closeToBottom.current && !closeToTop.current) {\n            scrollToBottom();\n        }\n    }, [closeToTop, closeToBottom, scrollToBottom]);\n    return {\n        hasNewMessages: hasNewMessages,\n        listRef: listRef,\n        onMessageLoadCaptured: onMessageLoadCaptured,\n        onScroll: onScroll,\n        scrollToBottom: scrollToBottom,\n        wrapperRect: wrapperRect,\n    };\n};\n"]},"metadata":{},"sourceType":"module"}